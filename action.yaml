name: 'Branch Issue'
description: 'Get the issue associated with the branch'

inputs:
  # input-1:
  #   description: Input description.
  #   required: false
  #   default: default-value
  # input-2:
  #   description: Input description.
  #   required: false
  #   default: default-value
  # input-3:
  #   description: Input description.
  #   required: false
  #   default: default-value
  github-token:
    description: 'GitHub token'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Extract issue number from branch
      id: extract-issue
      shell: bash
      run: |
        BRANCH="${GITHUB_REF##*/}"
        ISSUE_NO=$(echo $BRANCH|cut -d"-" -f1| cut -d"." -f2)

        echo "Found issue number: $ISSUE_NO"
        echo "Branch: $BRANCH"
        echo "Issue No: $ISSUE_NO"
        echo "issue-number=$ISSUE_NO" >> $GITHUB_OUTPUT
        echo "issue-exists=true" >> $GITHUB_OUTPUT

    - name: Check if GitHub issue exists
      id: issue-exists
      shell: bash
      if: steps.extract-issue.outputs.issue-exists == 'true'
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
      run: |
        ISSUE_NO=${{ steps.extract-issue.outputs.issue-number }}

        # Query GitHub issues via API
        RESPONSE=$(gh api repos/${{ github.repository }}/issues/$ISSUE_NO --jq ".number")
        echo $RESPONSE
        # STATUS_CODE=$(echo $RESPONSE|jq '.status')
        # echo "Status Code: $STATUS_CODE" >> $GITHUB_OUTPUT

        # if [[ "$STATUS_CODE" -ne 200 ]]; then
        #   echo "Issue #$ISSUE_NO not found in this repo. Failing."
        #   exit 1
        # else
        #   echo "Issue #$ISSUE_NO exists."
        # fi
